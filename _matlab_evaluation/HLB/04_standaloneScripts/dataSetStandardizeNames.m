
path = "";

matFiles = dir("C:\git\KDP\HLB_for_AV_MotionControl\02_Results\MassMeasurements\Dr015\*_withTraffic.mat");

signalNames = ["VelocityX_ESP", "VelocityX"; ...
    "SteeringTorque", "SteeringTorque"; ...
    "c1", "LaneOrientation"; ...
    "c01_right", "LaneEdgePositionRight"; ...
    "c01_left", "LaneEdgePositionLeft"; ...
    "c2", "LaneCurvature"; ...
    "objectDistanceFront", "ObjectDistanceFront"; ...
    "objectVelocityFront", "ObjectVelocityFront"; ...
    "objectAccelerationFront", "ObjectAccelerationFront"; ...
    "yawRateESP", "YawRate"; ...
    "AccelerationX_ESP", "AccelerationX"; ...
    "SteeringAngle", "RoadWheelAngleFront"; ...
    "GPS_status", "GPS_status"; ...
    "GPS_time", "GPS_time"; ...
    "AccelerationY_ESP", "Acceleration_Y"; ...
    "LongPos_abs", "LongPos_abs"; ...
    "LatPos_abs", "LatPos_abs"; ...
    "timeToPass", "OncomingVehicleTimeToPass"; ...
    "oncomingTraffic", "OncomingTrafficType"; ...
    "trafficInFront", "FrontTrafficType"; ...
    "q_T0", "Relative_time"];

for i=1:length(matFiles)
    a = load(fullfile(matFiles(i).folder, matFiles(i).name));
    if (isfield(a, "rawData"))
        a = a.rawData;
    elseif (isfield(a, "segment"))
        a = a.segment;
    end
    
    for j=1:size(signalNames,1)
        if (~isfield(a, signalNames(j,1)))
            data.(signalNames(j,2)) = zeros(1, size(a.q_T0,2));
        else
            data.(signalNames(j,2)) = a.(signalNames(j,1));
        end
    end
    data.Relative_time = data.Relative_time-data.Relative_time(1);
    save(fullfile(matFiles(i).folder, matFiles(i).name), '-struct',  'data');
    
    clear data a
end
    